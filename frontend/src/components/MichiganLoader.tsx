'use client'

import React, { useId } from 'react'

interface MichiganLoaderProps {
  size?: number
  strokeColor?: string
  fillColor?: string
  progress?: number // 0-100, optional for automatic animation
  className?: string
  'aria-label'?: string
}

export function MichiganLoader({
  size = 350,
  strokeColor = 'var(--color-michigan-blue)',
  fillColor = 'rgba(123, 189, 225, 0.2)', // michigan-blue with transparency
  progress,
  className = '',
  'aria-label': ariaLabel = 'Loading'
}: MichiganLoaderProps) {
  // Combined paths from your michigan.svg - all path elements combined
  // The SVG viewBox is "0 0 570 506"
  const michiganPaths = [
    // Path 1 (top section)
    "M504.000000,214.500000 C502.965302,210.299255 503.672607,205.042084 497.509918,203.944275 C497.100494,203.871368 496.522552,202.985291 496.545441,202.502151 C497.114624,190.478897 487.146606,189.721939 479.497437,186.506073 C475.845612,184.970779 471.792084,184.052292 468.583862,181.876373 C463.165344,178.201324 457.725006,175.506958 450.999237,176.494781 C449.337219,176.738876 448.539520,175.836273 447.387054,174.605804 C444.888458,171.938156 443.522125,168.575363 440.250977,166.160080 C437.067352,163.809433 434.290924,163.374634 431.002625,163.549164 C425.563416,163.837845 420.955994,162.835052 416.866272,158.630066 C414.246277,155.936279 410.234772,154.642456 407.044495,152.435699 C405.600403,151.436798 404.159576,150.812180 403.055359,152.049423 C399.050018,156.537445 393.737061,155.400787 388.496368,155.510757 C390.568024,159.303711 388.939362,161.410477 386.044342,163.559723 C378.743866,168.979568 378.620880,170.421143 380.375214,177.530792 C381.461639,181.933563 386.147034,181.473419 387.939575,184.597702 C386.424988,187.089508 383.842743,186.554031 381.501099,186.469498 C377.789154,186.335510 374.398834,186.566574 371.437653,189.435654 C368.753174,192.036591 365.938721,194.545944 362.042145,195.648880 C360.354431,196.126541 359.503723,198.414490 359.498535,200.500000 C359.479004,208.346527 359.354279,216.167023 358.631897,224.012146 C357.992737,230.953552 357.193634,232.548004 350.520294,234.567108 C348.523499,235.171265 346.635895,236.043579 344.500000,236.000000",
    // Path 2 (right side)
    "M550.000000,433.500000 C550.333313,432.666656 550.424927,431.517792 551.037292,431.048706 C557.289124,426.259125 556.658325,419.162445 557.542480,412.505646 C558.288818,406.885956 557.598755,400.871307 561.505676,396.004547 C562.976807,394.171997 562.869873,392.073517 562.474731,390.004822 C561.640320,385.636597 560.437805,381.173920 559.093140,377.135468 C557.176758,371.380127 557.202637,365.680328 556.665771,359.984375 C556.307739,356.185150 556.125732,352.402649 554.367615,349.069824 C553.698853,347.802124 553.412231,346.712494 553.532471,345.503235 C554.151917,339.274323 551.768372,333.200226 552.580505,327.010559 C552.818237,325.198700 551.974426,323.512299 551.342834,322.610016 C547.631836,317.308838 546.143860,310.759308 541.619873,305.888641 C540.526489,304.711456 539.715149,304.602173 538.500610,304.493134 C533.472656,304.041626 528.395020,303.960052 523.496521,302.511780 C523.190002,302.421173 522.695435,302.354736 522.520081,302.521179 C517.744751,307.053680 510.449799,305.269440 505.436798,309.423737 C503.444092,311.075134 501.468353,312.878937 500.629578,315.050079 C498.470947,320.637695 495.062897,326.081970 491.123505,329.575439 C486.736725,333.465668 482.460693,337.621124 477.944580,341.434357 C477.173096,342.085785 475.673340,341.874664 474.131317,342.122955 C474.338043,337.122284 469.931335,338.493103 467.449066,337.649994 C461.531982,335.640350 457.332397,328.473846 459.547577,322.517700 C460.886414,318.917816 460.268036,315.045990 462.282532,311.380493 C464.320587,307.672180 466.466248,306.196411 470.503723,306.437531 C473.751740,306.631500 476.814758,307.173798 479.287781,303.178131 C480.849274,300.655182 484.369110,299.960236 484.830933,295.534515 C485.258820,291.433624 486.480621,287.067902 488.209290,282.408539 C492.230469,283.354584 494.730255,281.325287 497.778931,278.279144 C500.916748,275.143951 501.238037,272.198792 501.554901,268.504700 C502.070557,262.493103 503.604431,256.603821 503.571899,250.499619 C503.557587,247.818863 506.234344,245.904099 505.211975,242.437485 C503.874359,237.901703 501.384460,234.463058 498.543304,230.964828 C496.069641,227.919022 493.128967,225.271515 493.337311,220.492905 C493.546295,215.700592 493.930908,214.411041 498.498474,214.550323 C500.624542,214.615143 503.121674,213.604095 504.750000,216.000000",
    // Path 3 (left side - lower peninsula start)
    "M9.500000,85.500000 C12.202802,85.461861 14.703566,85.897606 15.467618,89.007957 C15.930226,90.891151 17.287277,90.381271 18.498943,90.509949 C23.152615,91.004128 26.950644,93.467026 27.321978,98.014534 C27.985672,106.142410 34.035191,106.476814 39.513962,107.418785 C49.619663,109.156281 59.603096,111.407646 69.485535,114.054024 C81.712646,117.328278 93.810760,121.082886 106.024513,124.410011 C107.842316,124.905205 109.782036,125.480232 110.910629,126.590820 C115.885895,131.486710 122.441811,131.325134 128.514191,132.421371 C139.296982,134.368027 150.174713,135.785553 160.982086,137.606354 C161.710983,137.729156 162.470093,138.632797 163.500473,138.503815 C166.045242,138.185242 167.798111,139.024277 169.063156,141.467300 C170.539368,144.318176 168.429611,145.435287 167.022476,147.019958 C166.856979,147.206329 167.000000,147.666672 167.000000,148.377441 C171.209915,151.624710 176.665085,152.680923 181.528885,154.937759 C190.107178,158.918167 189.886337,158.749924 189.616867,168.503235 C189.468430,173.875092 189.089630,178.920670 186.037109,183.524612 C185.035767,185.034897 184.254517,186.766235 185.980988,188.518723 C187.733765,190.297928 189.157318,189.460358 191.046738,188.602997 C193.173111,187.638107 195.658997,187.465485 197.867981,186.974976 C200.709152,189.500000 199.816589,191.840591 198.087341,194.555618 C196.920074,196.388321 194.888977,197.610107 194.468460,199.994431 C193.843597,203.537415 198.824768,210.192902 202.500748,210.490738 C203.469254,210.569229 204.468246,210.747818 205.012161,209.505325 C209.904846,198.328766 218.840012,189.952667 225.482880,179.988586 C228.674377,175.201462 229.650879,169.151535 233.984634,164.984024 C235.087067,163.923859 235.832413,162.443008 237.032669,161.543594 C240.147720,159.209335 241.396454,156.309830 240.504135,152.499039 C239.891571,149.882904 242.101532,148.815552 243.545746,147.552292 C246.047623,145.363892 248.833328,143.500000 251.500000,141.500000",
    // Path 4 (upper peninsula start)
    "M390.500000,67.000000 C386.178467,68.700432 385.093811,72.539169 384.555695,76.507553 C384.062103,80.147934 385.004395,83.884438 383.614777,87.543587 C383.188477,88.666153 382.575195,91.268295 385.005157,91.413429 C389.161743,91.661690 391.885559,94.954117 395.926270,95.837334 C399.423004,96.601646 402.355072,96.048355 404.916931,94.825928 C408.550171,93.092285 411.429230,92.647804 413.957214,96.031967 C415.236786,97.744911 417.108276,98.024551 418.451294,97.395943 C422.672058,95.420403 427.284241,97.495850 431.562622,95.644722 C433.421509,94.840439 435.497437,95.271767 436.717010,98.415817 C438.322693,102.555298 438.909515,106.906433 440.427521,111.026703 C441.313202,113.430626 438.397980,114.818604 438.096710,117.099800 C438.971313,117.955803 439.835999,118.606544 441.499969,118.607178 C445.940186,118.608871 450.304688,122.227478 451.475342,126.506744 C452.354034,129.718811 454.736572,131.263214 457.499878,132.500244 C458.420349,132.912292 459.658875,132.758469 459.563599,134.503479 C459.459198,136.415237 457.757660,136.445511 457.009766,136.383118 C454.508514,136.174377 452.171265,136.915100 449.383942,135.786621 C445.688141,134.290329 441.150940,134.438187 437.004120,134.603271 C432.173950,134.795578 427.228271,133.028290 422.452637,135.404816 C421.635101,135.811646 419.725067,136.238220 419.057770,134.969604 C416.955780,130.973389 412.751617,131.820663 409.665771,130.300964 C406.071594,134.725845 407.143433,140.503479 405.029358,144.716812 C397.616730,146.355087 395.029724,139.764328 391.326965,136.615509 C386.106995,132.176437 380.442261,130.373138 374.474945,129.733719 C368.144806,129.055450 361.932739,127.563644 355.513245,127.238609 C351.999451,127.060699 349.685364,127.900375 347.531036,130.031372 C344.709595,132.822235 341.656219,134.217392 337.516754,134.657562 C327.164246,135.758347 316.732269,136.376923 306.495575,138.478394 C305.695923,138.642532 304.833160,138.488480 304.000031,138.501801 C296.307922,138.624664 296.426575,138.671158 293.448334,146.480301 C292.027161,150.206680 289.458466,152.979828 285.526947,154.566742 C281.377838,156.241501 277.659119,158.729675 275.000000,162.500000",
    // Path 5 (bottom of lower peninsula)
    "M399.000000,506.500000 C398.777191,503.987183 398.554382,501.474335 398.290619,498.500000 C384.504120,498.500000 371.001312,498.420624 357.500427,498.545929 C353.164368,498.586151 348.834320,499.439758 344.499847,499.455109 C318.833496,499.546112 293.166626,499.480530 267.500031,499.523712 C264.150940,499.529358 260.652863,498.361847 257.500000,500.500000",
    // Path 6 (top of upper peninsula)
    "M195.500000,10.500000 C194.340454,7.511746 190.595871,5.063512 188.017151,6.045048 C176.653580,10.370343 164.527695,11.766311 152.919815,15.231374 C148.203781,16.639153 144.613327,17.936033 142.428879,22.465700 C141.525116,24.339756 139.834778,25.834488 138.336212,27.709362 C134.280548,27.030840 130.490738,27.221865 128.403427,31.957436 C127.741463,33.459267 125.467171,33.845924 124.149979,34.724789 C120.364525,37.250515 113.896027,36.812271 113.440453,43.495941 C113.364502,44.610157 112.061302,45.012360 111.119629,45.671028 C108.992439,47.158932 106.436401,46.966667 104.464088,47.216530 C98.745987,47.940929 94.504456,50.367329 91.587067,55.054195 C90.623749,56.601803 89.199532,57.261555 87.988533,57.398891 C76.110123,58.746052 64.775597,62.698139 53.011524,64.572334 C51.312077,64.843086 49.441826,65.151466 47.985966,66.484673 C39.597435,74.166512 29.387823,77.989037 18.523216,80.596725 C15.893434,81.227921 12.797914,81.889351 11.500000,85.000000",
    // Path 7 (more upper peninsula detail)
    "M386.500000,69.000000 C378.669403,66.986229 371.023773,68.986427 363.536011,70.661072 C358.043182,71.889542 352.492981,72.660156 346.983276,73.370369 C331.197418,75.405197 315.156555,75.920593 299.584656,78.936958 C293.108582,80.191422 285.624512,82.694519 281.261230,89.854492 C279.105591,93.391769 273.819611,94.490982 270.417999,98.031166 C267.388397,94.091736 262.764130,94.013702 258.982727,93.782463 C252.935379,93.412651 248.347198,91.366501 244.817352,86.760475 C242.028610,87.677872 238.786972,86.689255 237.538208,90.014351 C237.131195,91.098129 236.446045,90.450119 235.999435,90.455841 C230.661758,90.524254 225.322922,90.500000 219.455261,90.500000 C220.292084,84.468506 216.586243,81.448204 213.148010,77.858238 C210.284485,74.868317 206.141434,72.406097 206.343307,66.994156 C206.453583,64.038101 201.210190,65.341614 200.750000,62.000000 C197.328430,64.080902 195.616699,61.060226 193.518433,59.475586 C188.803635,55.914921 182.864014,58.873020 178.016434,56.466881 C172.819000,53.887089 167.335022,55.177078 161.998596,55.108112 C157.451599,55.049347 153.360291,56.325966 151.313232,61.425018 C150.727676,62.883583 148.626968,64.414139 146.510956,65.037201 C144.387405,65.662476 143.428162,67.425613 143.000000,69.500000",
    // Path 8 (right side continuation)
    "M550.500000,430.000000 C548.895630,428.718872 546.544861,428.209320 547.795715,424.922272 C548.361816,423.434631 545.528748,421.781433 544.091492,422.651184 C542.061523,423.879517 539.852661,422.910675 537.414856,424.131805 C538.306763,427.440033 538.269043,430.711731 534.509033,432.518768 C533.266541,433.115845 533.393555,434.370544 533.506348,435.499359 C534.366699,444.107788 529.430237,448.365601 521.984070,450.442902 C518.185425,451.502594 516.149231,453.800659 515.513123,457.502258 C514.510681,463.335144 511.440216,468.705261 512.334595,475.023407 C512.707275,477.656281 510.071747,479.837860 507.966522,481.456482 C501.653320,486.310425 495.750641,491.362671 493.412445,499.474762 C492.911774,501.211761 490.974579,501.563354 488.999695,501.551147 C467.311401,501.417145 445.698181,503.588684 424.000671,503.671722 C416.698608,503.699646 409.351715,504.591705 402.000305,504.479126 C401.164612,504.466339 400.333344,504.166656 399.500000,504.000000",
    // Path 9 (central detail)
    "M348.750000,202.000000 C348.361328,204.140839 346.058960,205.874969 345.021057,205.776978 C340.771698,205.375839 340.417297,208.286789 339.470764,210.989761 C339.156189,211.888031 338.699677,212.989914 337.965210,213.443680 C334.897644,215.338745 332.497650,217.370773 332.330170,221.493103 C332.272308,222.916473 330.249054,224.259964 329.418671,225.278107 C324.652161,223.840454 320.577148,221.248520 317.924988,226.965195 C317.650116,227.557632 316.350372,227.720490 315.496948,227.990341 C312.408600,228.966812 310.815216,229.996521 312.291565,234.075439 C313.874512,238.448868 311.383820,242.056366 306.945160,243.305099 C300.133362,245.221481 299.719330,250.324554 299.617706,255.502304 C299.518768,260.543427 297.765472,265.421265 298.461426,270.505280 C298.570343,271.300903 298.394867,272.314423 297.965424,272.977600 C292.354370,281.642914 291.997253,293.204895 283.016968,300.022339 C281.145020,301.443451 280.439789,303.540283 282.038269,305.468262 C288.129425,312.814911 284.524231,321.472382 285.491028,329.501068 C285.665405,330.949188 284.150421,331.163879 283.464325,331.969604 C281.019562,334.840546 280.451050,339.282410 282.541382,342.472900 C283.479004,343.903961 284.843719,345.037354 284.503845,347.000671 C283.100861,355.105103 287.281708,361.249207 291.431366,367.545227 C294.129120,371.638367 296.132843,376.185333 298.509277,380.494873 C301.011078,385.031738 301.019226,390.106506 301.402100,395.007660 C301.829163,400.474274 301.581696,406.001617 301.472961,411.499451 C301.392578,415.564056 301.296997,419.573120 304.770172,423.240875 C300.755524,424.530365 300.217529,427.232666 300.458160,430.503082 C300.772583,434.776398 299.800629,438.925568 297.415009,442.442352 C295.903717,444.670227 295.222961,447.234344 294.685425,449.543182 C293.288940,455.541656 288.636932,459.379272 285.936249,464.466156 C282.189606,471.523163 276.982574,477.738861 275.306152,485.960480 C274.658661,489.136017 271.749084,491.867096 267.994751,492.467194 C264.435547,493.036041 262.780945,495.280945 262.000000,498.500000",
    // Path 10 (detail near thumb area)
    "M274.000000,164.000000 C271.143463,165.185547 268.347504,165.886612 265.877838,162.777985 C269.125427,159.264832 268.964478,153.273209 274.946625,151.335205 C278.321045,150.241989 278.853485,144.324921 276.416382,141.399643 C273.625336,141.958679 273.282043,144.948700 271.502350,146.502350 C269.819672,146.978134 268.535980,145.664841 267.038116,145.329620 C262.264465,144.261307 261.987488,144.189392 261.500000,149.000000 C260.989594,154.036850 254.952271,159.495224 250.000137,159.524368 C247.777527,159.537445 247.603668,157.923370 247.546112,156.498138 C247.405014,153.003830 247.500000,149.500000 247.500000,146.000000",
    // Path 11 (upper peninsula detail)
    "M196.500000,10.500000 C192.844147,12.180361 189.147949,13.694789 184.999771,13.504958 C183.465515,13.434746 181.739761,13.603834 181.052277,15.025286 C177.271286,22.843056 169.908310,26.697914 162.854645,30.207893 C159.001511,32.125248 161.991852,35.398468 159.547485,37.069469 C157.331909,38.584072 153.806015,38.186146 153.324249,42.480282 C152.808228,47.079845 150.862061,47.891911 146.080627,47.226425 C144.625839,53.250629 143.727081,59.300941 145.000000,65.500000",
    // Path 12 (detail)
    "M345.000000,206.500000 C342.711456,210.166672 349.121429,213.816193 345.004883,217.505447 C341.763214,220.410629 344.566467,224.667221 342.629578,228.073685 C341.255707,230.489929 343.509796,233.290451 343.479462,235.999771 C343.479431,236.001633 343.158203,236.032303 343.002228,235.991440 C342.825867,235.945236 342.666656,235.833328 342.500000,235.750000",
    // Path 13 (small detail line)
    "M351.500000,216.500000 C352.613434,222.471634 349.824402,228.108765 350.000000,234.000000"
  ]

  // Combine all paths into one continuous path for smooth animation
  const combinedPath = michiganPaths.join(' ')

  // Approximate total path length for animation calculation
  const pathLength = 4000 // Approximate combined path length
  
  // Calculate dash offset based on progress or use animation
  const strokeDasharray = `${pathLength}`
  const strokeDashoffset = progress !== undefined
    ? `${pathLength * (1 - progress / 100)}`
    : undefined

  // Generate unique animation name using useId for SSR compatibility
  const id = useId()
  const animationName = `michigan-loader-${id.replace(/:/g, '-')}`

  return (
    <div 
      className={`flex flex-col items-center justify-center ${className}`}
      role="status"
      aria-label={ariaLabel}
      aria-live="polite"
    >
      <svg
        width={size}
        height={size}
        viewBox="0 0 570 506"
        className="overflow-visible"
        preserveAspectRatio="xMidYMid meet"
        aria-hidden="true"
      >
        {/* Animated outline - progressively fills in based on progress */}
        {/* Use combined path for smoother progress-based animation */}
        {progress !== undefined ? (
          <path
            d={combinedPath}
            fill="none"
            stroke={strokeColor}
            strokeWidth="4"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeDasharray={strokeDasharray}
            strokeDashoffset={strokeDashoffset}
          />
        ) : (
          // For automatic animation, render paths separately with staggered delays
          michiganPaths.map((path, index) => (
            <path
              key={index}
              d={path}
              fill="none"
              stroke={strokeColor}
              strokeWidth="4"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeDasharray={strokeDasharray}
              style={{
                animationName: animationName,
                animationDuration: '4s',
                animationTimingFunction: 'ease-in-out',
                animationIterationCount: 'infinite',
                animationDelay: `${(index * 0.1).toFixed(1)}s`,
              }}
            />
          ))
        )}
        {/* Loading text in the center */}
        <text
          x="285"
          y="260"
          textAnchor="middle"
          dominantBaseline="middle"
          fontSize="48"
          fontWeight="600"
          fill="var(--color-michigan-blue)"
          style={{
            fontFamily: 'var(--font-heading)',
          }}
        >
          Loading
        </text>
      </svg>
      
      {/* CSS animation for automatic mode */}
      <style jsx>{`
        @keyframes ${animationName} {
          0% {
            stroke-dashoffset: ${pathLength};
            opacity: 0.3;
          }
          50% {
            stroke-dashoffset: 0;
            opacity: 1;
          }
          100% {
            stroke-dashoffset: -${pathLength};
            opacity: 0.3;
          }
        }
      `}</style>
    </div>
  )
}

// Default export for easier importing
export default MichiganLoader

